-- name: test_scan_predicate_expr_reuse
CREATE TABLE `t` (
  `v1` bigint NOT NULL COMMENT "",
  `v2` bigint NULL COMMENT "",
  `v3` bigint NULL COMMENT "",
  `v4` array<string> NULL COMMENT ""
) ENGINE=OLAP
DUPLICATE KEY(`v1`)
DISTRIBUTED BY RANDOM
PROPERTIES (
"replication_num" = "1"
);
-- result:
-- !result
insert into t select generate_series, generate_series, generate_series, array_repeat(cast(generate_series as string), 5) from table(generate_series(1, 100));
-- result:
-- !result
select * from t where v1 = 10 and v2 = v3;
-- result:
10	10	10	["10","10","10","10","10"]
-- !result
select * from t where v1 = 10 or v2 = v3 order by v1 limit 3;
-- result:
1	1	1	["1","1","1","1","1"]
2	2	2	["2","2","2","2","2"]
3	3	3	["3","3","3","3","3"]
-- !result
select * from t where v1 = v3 and (v2 = 5 or v3 = 10) order by v1;
-- result:
5	5	5	["5","5","5","5","5"]
10	10	10	["10","10","10","10","10"]
-- !result
select * from t where v1 < 10 and array_max(array_map(x->length(x) + v2, v4)) > 0 order by v1;
-- result:
1	1	1	["1","1","1","1","1"]
2	2	2	["2","2","2","2","2"]
3	3	3	["3","3","3","3","3"]
4	4	4	["4","4","4","4","4"]
5	5	5	["5","5","5","5","5"]
6	6	6	["6","6","6","6","6"]
7	7	7	["7","7","7","7","7"]
8	8	8	["8","8","8","8","8"]
9	9	9	["9","9","9","9","9"]
-- !result
set enable_scan_predicate_expr_reuse = false;
-- result:
-- !result
select * from t where v1 = 10 and v2 = v3;
-- result:
10	10	10	["10","10","10","10","10"]
-- !result
select * from t where v1 = 10 or v2 = v3 order by v1 limit 3;
-- result:
1	1	1	["1","1","1","1","1"]
2	2	2	["2","2","2","2","2"]
3	3	3	["3","3","3","3","3"]
-- !result
select * from t where v1 = v3 and (v2 = 5 or v3 = 10) order by v1;
-- result:
5	5	5	["5","5","5","5","5"]
10	10	10	["10","10","10","10","10"]
-- !result
select * from t where v1 < 10 and array_max(array_map(x->length(x) + v2, v4)) > 0 order by v1;
-- result:
1	1	1	["1","1","1","1","1"]
2	2	2	["2","2","2","2","2"]
3	3	3	["3","3","3","3","3"]
4	4	4	["4","4","4","4","4"]
5	5	5	["5","5","5","5","5"]
6	6	6	["6","6","6","6","6"]
7	7	7	["7","7","7","7","7"]
8	8	8	["8","8","8","8","8"]
9	9	9	["9","9","9","9","9"]
-- !result